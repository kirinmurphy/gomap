<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Global Location Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <style>
    #map { position: fixed; top: 0; bottom: 0; left: 0; right: 0; }

    .red-marker {
      filter: hue-rotate(0deg) saturate(100%) brightness(100%) invert(21%) sepia(100%) saturate(2202%) hue-rotate(340deg) brightness(90%) contrast(101%);
    }        
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    const map = L.map('map').setView([0, 0], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    const redIcon = new L.Icon({
      iconUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png',
      shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41],
      className: 'red-marker' // Add a custom class to apply CSS
    });
    
    htmx.on('htmx:afterSettle', function(evt) {
      const locations = JSON.parse(evt.detail.xhr.response);
      locations.forEach(function(loc) {
        const markerOptions = loc.isCo404Loc ? { icon: redIcon } : {};  
        L.marker([loc.latitude, loc.longitude], markerOptions).addTo(map)
          .bindPopup(loc.name);
      });
    });
  </script>

  <div hx-get="/locations" hx-trigger="load" hx-swap="none"></div>
</body>
</html>
